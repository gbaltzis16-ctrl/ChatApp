<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="base.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oxygen+Mono&display=swap" rel="stylesheet">
    <title>Title</title>
</head>
<body>
    <div id="name">
        <h2>enter your name</h2>
        <input type="text" id="nameInput" placeholder="username">
        <button id="joinButton">join chat</button>
    </div>
    <div id="container" style="display: none;">
        <div class="header">George's Chatroom</div>
        <div id="chat"></div>

        <div class="messageinput">
            <input id="msg" placeholder="Type message...">
            <button onclick="sendMsg()">Send</button>
            <button id="toggleTheme" onclick="toggleTheme()">ðŸŒ•</button>
        </div>
    </div>
    <script>
        let ws;
        const div= document.getElementById("chat");
        const theme= document.getElementById("toggleTheme");

        const nameScreen= document.getElementById("name");
        const chatscreen= document.getElementById("container");
        const joinButton= document.getElementById("joinButton");
        const nameInput= document.getElementById("nameInput");

        let username;



        function sendMsg(){
            const input= document.getElementById("msg");
            ws.send(input.value);
            div.innerText+= "You: " + input.value + "\n";
            input.value= "";
        }

        function updateIcon(){
            theme.textContent= document.body.classList.contains("dark")
            ? "â˜€ï¸"
            :"ðŸŒ•";
            }
        updateIcon();

        function toggleTheme(){
            document.body.classList.toggle("dark");
            updateIcon();
        }

        joinButton.addEventListener("click", ()=> {
            username= nameInput.value.trim();
            if(!username) return;
            StartChat();
        });

        function StartChat(){
            ws = new WebSocket ("wss://chatapp-yc8o.onrender.com/");

            ws.onopen= () => {
                div.innerText+= "[connected]\n";
                ws.send(username);

                nameScreen.classList.add("hidden");
                chatscreen.classList.remove("hidden");
            }

            ws.onmessage= (event) => {
                div.innerText+=  "Server: " +  event.data+"\n";
                div.scrollTop= div.scrollHeight;
            };

            ws.onclose= () => div.innerText+= "[disconnected]\n";

            ws.onerror= (err) => console.error("websocket error:",err);
        }
    </script>
</body>
</html>